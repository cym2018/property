<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>用户信息</title>
  <script src="../../static/js/vue.js"></script>
  <script src="../../static/js/axios.js"></script>
  <script>
    'use strict';
    Vue.use(VueRouter);

    function getQueryVariable() {
      var query = window.location.search.substring(1);
      var vars = query.split("&");
      for (var i = 0; i < vars.length; i++) {
        var pair = vars[i].split("=");
        if (pair[0] === 'userId') {
          return pair[1];
        }
      }
      return false;
    }

    let userInfo = {};
    let userId = getQueryVariable();
    let recodeList = [];
  </script>
  <style>
    table, table tr th, table tr td {
      border: 1px solid #0094ff;
    }
  </style>
</head>
<body>
<div id="app">
  <h1>编辑</h1>
  <form @submit.prevent="submit($event)">
    姓名:<input v-model="userInfo.name" name="name" type="text"/><br>
    楼号:<input v-model="userInfo.buildingNumber" name="buildingNumber" type="number"/><br>
    单元:<input v-model="userInfo.unitNumber" name="unitNumber" type="number"/><br>
    房号:<input v-model="userInfo.roomNumber" name="roomNumber" type="number"/><br>
    面积:<input v-model="userInfo.area" name="area"/><br>
    交费至:<input v-model="userInfo.paidForTime" name="paidForTime" type="date"/><br>
    文字备注1:<input v-model="userInfo.textNote1" name="textNote1" type="text"/><br>
    文字备注2:<input v-model="userInfo.textNote2" name="textNote2" type="text"/><br>
    数值备注1:<input v-model="userInfo.numberNote1" name="numberNote1"/><br>
    数值备注2:<input v-model="userInfo.numberNote2" name="numberNote2"/><br>
    <button type="submit">保存</button>
  </form>
  <h1>交易历史</h1>
  <table>
    <tr>
      <th>标题</th>
      <th>交易日期</th>
      <th>支付方式</th>
      <th>支付金额</th>
      <th>备注</th>
      <th>操作</th>
    </tr>
    <tr v-for="(object,i) in recodeList">
      <td>{{object.title}}</td>
      <td>{{object.date}}</td>
      <td>{{object.paidWay}}</td>
      <td>{{object.amount}}</td>
      <td>{{object.note}}</td>
      <td>
        <button>修改</button>
        <button>删除</button>
      </td>
    </tr>
    <tr>
      <td>
        <button>添加</button>
      </td>
    </tr>
  </table>
</div>
<script>
  let app = new Vue({
    el: '#app',
    data: {
      userId,
      recodeList,
      userInfo,
    }
    , created() {
      this.getData();
      this.getInfo();
    }, methods: {
      submit: function (event) {
        var formData = new FormData(event.target);
        let self = this;
        console.log(formData);
        axios.get('/user/save', {
          params: {
            id: this.userId,
            name: this.userInfo.name,
            buildingNumber: this.userInfo.buildingNumber,
            unitNumber: this.userInfo.unitNumber,
            roomNumber: this.userInfo.roomNumber,
            area: this.userInfo.area,
            paidForTime: this.userInfo.paidForTime,
            textNote1: this.userInfo.textNote1,
            textNote2: this.userInfo.textNote2,
            numberNote1: this.userInfo.numberNote1,
            numberNote2: this.userInfo.numberNote2,
          }
        }).then(res => {
          alert(res.data);
        });
      },


      getData: function () {
        let self = this;
        axios.get('/recode/query?userId=' + this.userId).then((res => {
          this.recodeList = res.data;
        }));
      },
      getInfo: function () {
        let self = this;
        axios.get('/user/query?id=' + this.userId).then((res => {
          this.userInfo = res.data;
        }));
      },
    }
  });
</script>
</body>
</html>